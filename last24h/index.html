<!doctype html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="icon" type="image/png" href="../img/favicon32.png">
        <link rel="stylesheet" href="../libs/nprogress.css"/>
        <link rel="stylesheet" href="../charts.css"/>
        <title>Stack Overflow Stats - Last 24 hours</title>
        <style>
            html {
                height: 100%;
            }
            body {
                font-family: sans-serif;
                margin: 0 5%;
                position: relative;
                min-height: 100%;
                padding-bottom: 2.8125em;
                box-sizing: border-box;
            }
            @media (max-width: 600px) {
              .body {
                margin: 0;
              }
            }
            a {
                text-decoration: none;
                color: #f48024;
            }
            #header {
                border-bottom: 1px solid #eee;
            }
            #header img {
                vertical-align: middle;
            }
            .tabs {
                display: inline-block;
                vertical-align: middle;
                line-height: 40px
            }
            .tabs a {
                display: inline-block;
                line-height; inherit;
                color: #848d95;
                text-decoration: none;
                padding: 0 10px;
            }
            .tabs a.current {
                color: #f48024;
                background-color: #eee;
            }
            .tabs a:hover {
                background-color: #eee;
            }
            #footer {
                position: absolute;
                left: 0;
                right: 0;
                bottom: 0;
                border-top: 1px solid #eee;
                font-size: 0.8125em;
                padding: 1em 0;
                text-align: right;
            }
            #gauges {
                text-align: center;
            }
            #g-group {
                display: inline-block;
            }
            #g1, #g2, #g3, #g4 {
                width: 300px;
                height: 200px;
                display: inline-block;
                margin: 1em;
            }
            
            #main {
                width: 100%;
                min-height: 3px;
            }
            
        </style>
    </head>
    <body>
        <div id="header">
            <img src="../img/logo.svg" onerror="this.src='../img/logo.png'"></img>
            <div class="tabs">
                <a href="/">Dashboard</a>
                <a href="/last24h" class="current">Last 24h</a>
                <a href="/last30days">Last 30 days</a>
            </div>
        </div>
        <div id="main">
            <div class="charts">
                <div id="questions" class="chart">
                </div>
                <div id="answers" class="chart">
                </div>
                <div id="comments" class="chart">
                </div>
                <div id="users" class="chart">
                </div>
            </div>
        </div>
        <div id="footer">
            Created by <a href="http://stackoverflow.com/users/853558/lukasz-wiktor" target="_blank">≈Åukasz Wiktor</a>
        </div>
        <script src="../libs/d3.min.js" charset="utf-8"></script>
        <script src="../libs/nprogress.js"></script>
        <script src="../libs/firebase.js"></script>
        <script src="../barchart.js"></script>
        <script>
            var q, a, c, u;
            NProgress.configure({ 
                parent: '#main',
                showSpinner: false 
            });
            NProgress.start();
            var reqCount = 4;
            var firebaseRef = new Firebase("https://sostats.firebaseio.com/");
            function mouseover(d, i) {
                q.hover(d, true);
                a.hover(d, true);
                c.hover(d, true);
                u.hover(d, true);
            }
            function mouseout(d, i) {
                q.hover(d, false);
                a.hover(d, false);
                c.hover(d, false);
                u.hover(d, false);
            }
            var timeFormat = d3.time.format("%H:%M");
            function tickFormat(d) {
                return timeFormat(d);
            }
            firebaseRef.child("stats/questions/hourly").limitToLast(24).once("value", function(snapshot) {
                if (!--reqCount) {
                    NProgress.done();
                }
                q = createBarChart({
                    containerId: "questions",
                    data: transformData(snapshot),
                    title: "Questions",
                    tickFormat: tickFormat,
                    tooltip: {
                        width: 40,
                    },
                    mouseover: mouseover,
                    mouseout: mouseout
                });
            });
            firebaseRef.child("stats/answers/hourly").limitToLast(24).once("value", function(snapshot) {
                if (!--reqCount) {
                    NProgress.done();
                }
                a = createBarChart({
                    containerId: "answers",
                    data: transformData(snapshot),
                    title: "Answers",
                    tickFormat: tickFormat,
                    tooltip: {
                        width: 40,
                    },
                    mouseover: mouseover,
                    mouseout: mouseout
                });
            });
            firebaseRef.child("stats/comments/hourly").limitToLast(24).once("value", function(snapshot) {
                if (!--reqCount) {
                    NProgress.done();
                }
                c = createBarChart({
                    containerId: "comments",
                    data: transformData(snapshot),
                    title: "Comments",
                    tickFormat: tickFormat,
                    tooltip: {
                        width: 40,
                    },
                    mouseover: mouseover,
                    mouseout: mouseout
                });
            });
            firebaseRef.child("stats/users/hourly").limitToLast(24).once("value", function(snapshot) {
                if (!--reqCount) {
                    NProgress.done();
                }
                u = createBarChart({
                    containerId: "users",
                    data: transformData(snapshot),
                    title: "New Users",
                    tickFormat: tickFormat,
                    tooltip: {
                        width: 40,
                    },
                    mouseover: mouseover,
                    mouseout: mouseout
                });
            });
            
            function transformData(snapshot) {
                var data = [];
                snapshot.forEach(function(child) {
                    data.push({
                        ts: new Date(child.key()),
                        count: child.val().count
                    })
                });
                return data;
            }
            
            var windowWidth = window.innerWidth;
            window.addEventListener('resize', function() {
                if (windowWidth === window.innerWidth) {
                    return "skip resize";
                }
                q = createBarChart(q.options);
                a = createBarChart(a.options);
                c = createBarChart(c.options);
                u = createBarChart(u.options);
                windowWidth = window.innerWidth;
            })
        </script>
        <script>
            (function(){
                    var t,i,e,n=window,o=document,a=arguments,s="script",r=["config","track","identify","visit","push","call","trackForm","trackClick"],c=function(){var t,i=this;for(i._e=[],t=0;r.length>t;t++)(function(t){i[t]=function(){return i._e.push([t].concat(Array.prototype.slice.call(arguments,0))),i}})(r[t])};for(n._w=n._w||{},t=0;a.length>t;t++)n._w[a[t]]=n[a[t]]=n[a[t]]||new c;i=o.createElement(s),i.async=1,i.src="//static.woopra.com/js/w.js",e=o.getElementsByTagName(s)[0],e.parentNode.insertBefore(i,e)
            })("woopra");

            woopra.config({
                domain: 'sostats.github.io'
            });
            woopra.track();
        </script>
        <script type="text/javascript">
            window.smartlook||(function(d) {
            var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];
            var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';
            c.charset='utf-8';c.src='//rec.smartlook.com/recorder.js';h.appendChild(c);
            })(document);
            smartlook('init', '82f5bdb1a67f1175b7264e2ab7042c04d57167df');
        </script>
    </body>
</html>